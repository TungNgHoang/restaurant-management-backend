using RestaurantManagement.Service.Dtos.AttendanceDto;

namespace RestaurantManagement.Api.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class AssignmentController : ControllerBase
    {
        private readonly IAssignmentService _AssignmentService;

        public AssignmentController(IAssignmentService shiftAssignmentService)
        {
            _AssignmentService = shiftAssignmentService;
        }

        [Authorize(Policy = "ManagerPolicy")]
        [HttpPut("create-and-update-assignment")]
        public async Task<IActionResult> UpdateAssignment([FromBody] AssignmentRequestDto dto)
        {
            try
            {
                await _AssignmentService.SaveAssignmentsAsync(dto);
                return Ok(new { Success = true, Message = StatusCodeEnum.G04 });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { Success = false, Message = ex.Message });
            }
        }

        [Authorize(Policy = "ManagerPolicy")]
        [HttpGet("assignments-grouped")]
        public async Task<IActionResult> GetAssignmentsGrouped()
        {
            var data = await _AssignmentService.GetAssignmentsGroupedByDateAsync();
            return Ok(data);
        }

        [Authorize(Policy = "ManagerPolicy")]
        [HttpGet("assignments-by-date")]
        public async Task<IActionResult> GetAssignmentsByDate([FromQuery] DateOnly date)
        {
            try
            {
                var assignments = await _AssignmentService.GetAssignmentsByDateAsync(date);
                return Ok(assignments);
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { message = ex.Message });
            }
        }

    }
}
